{% extends "base.html" %}
{% load i18n %}
{% block content %}
<h4 class="mb-3">{% trans "Issue" %} #{{ issue.id }}</h4>
{% if can_change_issue %}
  <div class="mb-3">
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'issue_edit' issue.id %}">{% trans "Edit" %}</a>
  </div>
{% endif %}
<div class="card mb-3">
  <div class="card-body">
    <div><strong>{% trans "Warehouse" %}:</strong> {{ issue.warehouse.name }}</div>
    <div><strong>{% trans "Outgoing Location" %}:</strong> {{ issue.outgoing_location.name }}</div>
    <div><strong>{% trans "Type" %}:</strong> {{ issue.outgoing_location.get_type_display }}</div>
    <div><strong>{% trans "Issue Date" %}:</strong> {{ issue.issue_date|date:"d.m.Y" }}</div>
    <div><strong>{% trans "Notes" %}:</strong> {{ issue.notes }}</div>
  </div>
</div>
<div class="card mb-3">
  <div class="card-body p-0">
    <table class="table table-dense mb-0">
      <thead><tr><th>{% trans "Item" %}</th><th>{% trans "Unit" %}</th><th>{% trans "Qty" %}</th></tr></thead>
      <tbody>
        {% for line in lines %}
          <tr><td>{{ line.item.name }}</td><td>{{ line.item.unit }}</td><td>{{ line.qty }}</td></tr>
        {% empty %}
          <tr><td colspan="3">{% trans "No lines." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="card">
  <div class="card-body">
    <h6>{% trans "Attachments" %}</h6>
    {% if perms.issuing.change_issueheader %}
      <form method="post" enctype="multipart/form-data" class="mb-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_attachment">
        <div class="row g-2 align-items-center">
          <div class="col-md-8">
            <input class="form-control" type="file" name="attachments" multiple />
          </div>
          <div class="col-md-4">
            <button class="btn btn-sm btn-outline-primary" type="submit">{% trans "Add" %}</button>
          </div>
        </div>
      </form>
    {% endif %}
    <ul class="list-group list-group-flush">
      {% for att in attachments %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <a href="{{ att.file.url }}" target="_blank">{{ att.original_name }}</a>
            <span class="text-muted ms-2">{{ att.uploaded_at }}</span>
          </div>
          {% if perms.issuing.change_issueheader %}
            <form method="post" class="m-0">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_attachment">
              <input type="hidden" name="attachment_id" value="{{ att.id }}">
              <button class="btn btn-sm btn-outline-danger" type="submit">{% trans "Delete" %}</button>
            </form>
          {% endif %}
        </li>
      {% empty %}
        <li class="list-group-item text-muted">{% trans "No attachments." %}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
