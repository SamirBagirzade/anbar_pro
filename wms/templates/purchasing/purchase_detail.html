{% extends "base.html" %}
{% load i18n %}
{% block content %}
<h4 class="mb-3">{% trans "Purchase" %} #{{ purchase.id }}</h4>
<div class="card mb-3">
  <div class="card-body">
    <div><strong>{% trans "Vendor" %}:</strong> {{ purchase.vendor.name }}</div>
    <div><strong>{% trans "Warehouse" %}:</strong> {{ purchase.warehouse.name }}</div>
    <div><strong>{% trans "Invoice Date" %}:</strong> {{ purchase.invoice_date|date:"d.m.Y" }}</div>
    <div><strong>{% trans "Notes" %}:</strong> {{ purchase.notes }}</div>
  </div>
</div>
<div class="card mb-3">
  <div class="card-body p-0">
    <table class="table table-dense mb-0">
      <thead><tr><th>{% trans "Item" %}</th><th>{% trans "Qty" %}</th><th>{% trans "Unit Price" %}</th><th>{% trans "Line Total" %}</th></tr></thead>
      <tbody>
        {% for line in lines %}
          <tr><td>{{ line.item.name }}</td><td>{{ line.qty }}</td><td>{{ line.unit_price }}</td><td>{{ line.line_total }}</td></tr>
        {% empty %}
          <tr><td colspan="4">{% trans "No lines." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="card">
  <div class="card-body">
    <h6>{% trans "Attachments" %}</h6>
    {% if perms.purchasing.change_purchaseheader %}
      <form method="post" enctype="multipart/form-data" class="mb-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_attachment">
        <div class="row g-2 align-items-center">
          <div class="col-md-8">
            <input class="form-control" type="file" name="attachments" multiple />
          </div>
          <div class="col-md-4">
            <button class="btn btn-sm btn-outline-primary" type="submit">{% trans "Add" %}</button>
          </div>
        </div>
      </form>
    {% endif %}
    <ul class="list-group list-group-flush">
      {% for att in attachments %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <a href="{{ att.file.url }}" target="_blank">{{ att.original_name }}</a>
            <span class="text-muted ms-2">{{ att.uploaded_at }}</span>
          </div>
          {% if perms.purchasing.change_purchaseheader %}
            <form method="post" class="m-0">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_attachment">
              <input type="hidden" name="attachment_id" value="{{ att.id }}">
              <button class="btn btn-sm btn-outline-danger" type="submit">{% trans "Delete" %}</button>
            </form>
          {% endif %}
        </li>
      {% empty %}
        <li class="list-group-item text-muted">{% trans "No attachments." %}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
