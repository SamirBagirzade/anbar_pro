{% load i18n %}
<div class="card">
  <div class="card-body p-0">
    <table class="table table-striped table-hover table-dense mb-0">
  <thead>
    <tr>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Name" %}{% if sort == "name" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=category&direction={% if sort == 'category' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Category" %}{% if sort == "category" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=unit&direction={% if sort == 'unit' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Unit" %}{% if sort == "unit" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=on_hand&direction={% if sort == 'on_hand' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "On Hand" %}{% if sort == "on_hand" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=min_stock&direction={% if sort == 'min_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Min" %}{% if sort == "min_stock" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=last_purchase_vendor&direction={% if sort == 'last_purchase_vendor' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Last Purchase Vendor" %}{% if sort == "last_purchase_vendor" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=last_purchase_unit_price&direction={% if sort == 'last_purchase_unit_price' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Last Purchase Price" %}{% if sort == "last_purchase_unit_price" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=last_purchase_date&direction={% if sort == 'last_purchase_date' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Last Purchase Date" %}{% if sort == "last_purchase_date" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>
        <a class="link-dark text-decoration-none" hx-get="?warehouse={{ selected_warehouse_id }}&vendor={{ selected_vendor_id }}&q={{ q|urlencode }}{% if low_stock %}&low_stock=1{% endif %}&sort=last_issue_date&direction={% if sort == 'last_issue_date' and direction == 'asc' %}desc{% else %}asc{% endif %}" hx-target="#stock-table" hx-push-url="true">{% trans "Last Issue Date" %}{% if sort == "last_issue_date" %} {% if direction == "asc" %}↑{% else %}↓{% endif %}{% endif %}</a>
      </th>
      <th>{% trans "Actions" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr>
        <td><a href="{% url 'item_detail' item.id %}">{{ item.name }}</a></td>
        <td>{{ item.category }}</td>
        <td>{{ item.unit }}</td>
        <td class="{% if item.on_hand < item.min_stock %}text-danger{% endif %}">{{ item.on_hand }}</td>
        <td>{{ item.min_stock }}</td>
        <td>
          {% if item.last_purchase_vendor_color %}
            <span class="me-2" style="display:inline-block;width:10px;height:10px;border-radius:50%;background:{{ item.last_purchase_vendor_color }};"></span>
          {% endif %}
          {{ item.last_purchase_vendor }}
        </td>
        <td>{{ item.last_purchase_unit_price }}</td>
        <td>{{ item.last_purchase_date|date:"d.m.Y" }}</td>
        <td>{{ item.last_issue_date|date:"d.m.Y" }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="{% url 'purchase_create' %}?item={{ item.id }}">{% trans "Quick Purchase" %}</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="10">{% trans "No items." %}</td></tr>
    {% endfor %}
  </tbody>
</table>
  </div>
</div>
<nav class="mt-3">
  <ul class="pagination">
    {% if items.has_previous %}
      <li class="page-item">
        <a class="page-link" hx-get="?{% if base_query %}{{ base_query }}&{% endif %}page={{ items.previous_page_number }}" hx-target="#stock-table" hx-push-url="true">{% trans "Prev" %}</a>
      </li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ items.number }} / {{ items.paginator.num_pages }}</span></li>
    {% if items.has_next %}
      <li class="page-item">
        <a class="page-link" hx-get="?{% if base_query %}{{ base_query }}&{% endif %}page={{ items.next_page_number }}" hx-target="#stock-table" hx-push-url="true">{% trans "Next" %}</a>
      </li>
    {% endif %}
  </ul>
</nav>
